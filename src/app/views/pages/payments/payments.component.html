<div class="flex flex-col">
  <p class="text-xl font-bold">
    <span class="text-[#707070]">Accueil / Gestion /</span>
    <span class="text-primary-text">Paiements ({{ total }})</span>
  </p>

  <div class="flex flex-col min-h-100 bg-card text-primary-text shadow-lg rounded-lg p-4 gap-4 mt-8">
    <p class="font-bold mt-4 text-primary-500">Filtrer</p>
    <div class="flex md:flex-row flex-col justify-between gap-2 min-h-20 items-center">
      <input
        [formControl]="searchControl"
        type="text"
        placeholder="Rechercher par élève, numéro ou référence"
        class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-primary-500 focus:border-transparent md:w-1/3 w-full"
      />
      <select
        [(ngModel)]="actualStatus"
        (change)="onStatusChange()"
        class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-primary-500 focus:border-transparent md:w-1/3 w-full"
      >
        <option *ngFor="let option of statusOptions" [value]="option.value">
          {{ option.label }}
        </option>
      </select>
      <select
        [(ngModel)]="selectedMonth"
        (change)="onMonthChange()"
        class="px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-primary-500 focus:border-transparent md:w-1/3 w-full"
      >
        <option *ngFor="let month of months" [value]="month.value">
          {{ month.label }}
        </option>
      </select>
    </div>

    <div class="w-full h-[1px] bg-[#D1D8EB]"></div>

    <div class="flex md:flex-row flex-col justify-between gap-2">
      <div class="flex flex-row gap-2"></div>

      <div class="flex flex-row gap-2">
        <select
          id="perPage"
          class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-1 focus:ring-primary-500"
          [(ngModel)]="actualLimit"
          (change)="getPaymentsList(actualPage, actualLimit)"
        >
          <option value="5">5</option>
          <option value="10">10</option>
          <option value="20">20</option>
        </select>
        <select
          id="export"
          class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-1 focus:ring-primary-500 bg-[#A8AAAE29]"
        >
          <option value="" disabled selected>Export</option>
          <option value="pdf">PDF</option>
          <option value="excel">Excel</option>
        </select>
      </div>
    </div>

    <div class="flex flex-col gap-2">
      <div class="overflow-x-auto">
        <table class="w-full border-collapse">
          <thead>
            <tr>
              <th class="p-2 border-b text-left">Élève</th>
              <th class="p-2 border-b text-left">Classe</th>
              <th class="p-2 border-b text-left">Mois</th>
              <th class="p-2 border-b text-left">Montant</th>
              <th class="p-2 border-b text-left">Date de paiement</th>
              <th class="p-2 border-b text-left">Échéance</th>
              <th class="p-2 border-b text-left">Méthode</th>
              <th class="p-2 border-b text-left">Statut</th>
              <th class="p-2 border-b text-left">Référence</th>
              <th class="p-2 border-b text-left">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let payment of paymentsList" class="border-b border-gray-300">
              <td class="p-2">
                <div class="flex flex-row gap-2 items-center">
                  <svg width="30" height="30" viewBox="0 0 38 38" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <g clip-path="url(#clip0_50_5632)">
                      <rect x="-0.1604" y="0.0273438" width="38" height="38" fill="#FC2828" fill-opacity="0.18" />
                      <path
                        d="M13.4942 24.9195C13.1242 24.9195 12.7667 24.8795 12.4217 24.7995C12.0767 24.7195 11.8392 24.657 11.7092 24.612L11.7917 23.097C11.9467 23.147 12.1217 23.2095 12.3167 23.2845C12.5167 23.3545 12.7592 23.3895 13.0442 23.3895C13.5342 23.3895 13.8692 23.2545 14.0492 22.9845C14.2292 22.7145 14.3192 22.267 14.3192 21.642V13.9245H15.9317V22.0845C15.9317 22.6945 15.8617 23.212 15.7217 23.637C15.5867 24.057 15.3442 24.377 14.9942 24.597C14.6442 24.812 14.1442 24.9195 13.4942 24.9195ZM18.3933 24.7695V13.9245H20.0658V19.362L24.6783 13.9245H26.5683L23.0283 18.1695L26.8983 24.7695H25.1133L21.8658 19.3395L20.0658 21.432V24.7695H18.3933Z"
                        fill="#FC2828"
                      />
                    </g>
                    <defs>
                      <clipPath id="clip0_50_5632">
                        <rect width="38" height="38" rx="19" fill="white" />
                      </clipPath>
                    </defs>
                  </svg>
                  <span class="cursor-pointer hover:text-primary-500" (click)="goToStudentDetail(payment.student_id)">
                    {{ payment.student_name }}
                  </span>
                </div>
              </td>
              <td class="p-2">{{ payment.class_name || '-' }}</td>
              <td class="p-2">{{ getMonthLabel(payment.month) }}</td>
              <td class="p-2 font-semibold">{{ formatAmount(payment.amount) }}</td>
              <td class="p-2">
                <span *ngIf="payment.payment_date; else noDate">
                  {{ payment.payment_date | date:'dd/MM/yyyy' }}
                </span>
                <ng-template #noDate>-</ng-template>
              </td>
              <td class="p-2">{{ payment.due_date | date:'dd/MM/yyyy' }}</td>
              <td class="p-2">
                <span *ngIf="payment.payment_method; else noMethod">
                  {{ payment.payment_method === 'bank_transfer' ? 'Virement' : 
                     payment.payment_method === 'mobile_money' ? 'Mobile Money' : 
                     payment.payment_method === 'cash' ? 'Espèces' : 
                     payment.payment_method === 'check' ? 'Chèque' : payment.payment_method }}
                </span>
                <ng-template #noMethod>-</ng-template>
              </td>
              <td class="p-2">
                <span [ngClass]="getStatusClass(payment.status)" class="px-2 py-1 rounded-full text-xs font-semibold">
                  {{ getStatusLabel(payment.status) }}
                </span>
              </td>
              <td class="p-2">
                <span *ngIf="payment.reference; else noRef">{{ payment.reference }}</span>
                <ng-template #noRef>-</ng-template>
              </td>
              <td class="p-2">
                <div class="flex flex-row gap-2">
                  <a
                    [routerLink]="['/detailUser', payment.student_id]"
                    class="cursor-pointer text-primary-500 hover:underline"
                    title="Voir les détails de l'élève"
                  >
                    <svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path
                        d="M11 4.58398C15.5924 4.58398 19.3334 7.63365 19.3334 11.458C19.3334 15.2823 15.5924 18.332 11 18.332C6.40759 18.332 2.66659 15.2823 2.66659 11.458C2.66659 7.63365 6.40759 4.58398 11 4.58398ZM11 6.41602C7.42743 6.41602 4.54159 8.66732 4.54159 11.458C4.54159 14.2487 7.42743 16.5 11 16.5C14.5726 16.5 17.4584 14.2487 17.4584 11.458C17.4584 8.66732 14.5726 6.41602 11 6.41602ZM11 8.24935C12.5188 8.24935 13.75 9.48056 13.75 10.9993C13.75 12.5181 12.5188 13.7493 11 13.7493C9.48122 13.7493 8.25002 12.5181 8.25002 10.9993C8.25002 9.48056 9.48122 8.24935 11 8.24935Z"
                        fill="#4B465C"
                      />
                    </svg>
                  </a>
                </div>
              </td>
            </tr>
            <tr *ngIf="paymentsList.length === 0">
              <td colspan="10" class="p-8 text-center text-gray-500">Aucun paiement trouvé</td>
            </tr>
          </tbody>
        </table>
      </div>

      <div class="flex flex-row md:justify-end justify-center gap-1 m-4">
        <button
          class="hidden md:block px-4 py-2 rounded-lg bg-primary-500 text-white cursor-pointer"
          (click)="changePage(actualPage - 1)"
          [disabled]="actualPage === 1"
        >
          Précédent
        </button>
        <button
          class="md:hidden px-1 py-2 rounded-lg bg-primary-500 text-white cursor-pointer"
          (click)="changePage(actualPage - 1)"
          [disabled]="actualPage === 1"
        >
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <g clip-path="url(#clip0_1265_7706)">
              <path
                d="M17.5098 3.8701L15.7298 2.1001L5.83984 12.0001L15.7398 21.9001L17.5098 20.1301L9.37984 12.0001L17.5098 3.8701Z"
                fill="currentColor"
              />
            </g>
            <defs>
              <clipPath id="clip0_1265_7706">
                <rect width="24" height="24" fill="white" />
              </clipPath>
            </defs>
          </svg>
        </button>
        <button
          *ngFor="let pageNumber of [].constructor(totalPages); let i = index"
          (click)="changePage(i + 1)"
          class="rounded-lg px-4 bg-[#4B465C29] cursor-pointer transition-ease"
          [ngClass]="{ 'bg-primary-500 text-white': actualPage === i + 1 }"
        >
          {{ i + 1 }}
        </button>
        <button
          class="hidden md:block px-4 py-2 rounded-lg bg-primary-500 text-white cursor-pointer"
          (click)="changePage(actualPage + 1)"
          [disabled]="actualPage === totalPages"
        >
          Suivant
        </button>
        <button
          class="md:hidden px-1 py-2 rounded-lg bg-primary-500 text-white cursor-pointer"
          (click)="changePage(actualPage + 1)"
          [disabled]="actualPage === totalPages"
        >
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <g clip-path="url(#clip0_1265_7724)">
              <path
                d="M6.49023 20.1301L8.26023 21.9001L18.1602 12.0001L8.26023 2.1001L6.49023 3.8701L14.6202 12.0001L6.49023 20.1301Z"
                fill="currentColor"
              />
            </g>
            <defs>
              <clipPath id="clip0_1265_7724">
                <rect width="24" height="24" fill="white" />
              </clipPath>
            </defs>
          </svg>
        </button>
      </div>
    </div>
  </div>
</div>

