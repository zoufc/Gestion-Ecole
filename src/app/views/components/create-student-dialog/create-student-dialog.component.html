<div
  class="fixed top-0 right-0 h-screen w-full md:w-2/3 lg:w-1/2 bg-card text-primary-text shadow-lg transform transition-transform translate-x-0 overflow-y-auto"
>
  <div class="flex justify-between items-center p-4 border-b border-[#707070] sticky top-0 bg-card z-10">
    <h2 class="text-lg font-bold">
      {{ isEditing ? 'Modifier un élève' : 'Inscrire un élève' }}
    </h2>
    <button
      (click)="closeDialog()"
      class="text-gray-500 hover:text-gray-700 cursor-pointer"
    >
      <div class="px-4 py-2 rounded border-1">✖</div>
    </button>
  </div>
  <form [formGroup]="createStudentForm" (ngSubmit)="onSubmitStudent()">
    <div class="flex flex-col p-6 gap-4 w-full">
      <!-- Informations personnelles -->
      <div class="border-b pb-4">
        <h3 class="text-md font-semibold mb-3">Informations personnelles</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <p class="text-sm mb-1">Prénom <span class="text-red-500">*</span></p>
            <input
              type="text"
              formControlName="firstName"
              class="px-4 py-2 border bg-card border-gray-300 rounded-lg focus:ring-1 focus:ring-primary-500 focus:border-primary-500 focus:outline-none w-full"
              placeholder="Amadou"
            />
            <div
              *ngIf="
                createStudentForm.get('firstName')?.invalid &&
                createStudentForm.get('firstName')?.touched
              "
              class="text-red-500 text-xs mt-1"
            >
              Le prénom est requis
            </div>
          </div>

          <div>
            <p class="text-sm mb-1">Nom <span class="text-red-500">*</span></p>
            <input
              type="text"
              formControlName="lastName"
              class="px-4 py-2 border bg-card border-gray-300 rounded-lg focus:ring-1 focus:ring-primary-500 focus:border-primary-500 focus:outline-none w-full"
              placeholder="Diallo"
            />
            <div
              *ngIf="
                createStudentForm.get('lastName')?.invalid &&
                createStudentForm.get('lastName')?.touched
              "
              class="text-red-500 text-xs mt-1"
            >
              Le nom est requis
            </div>
          </div>

          <div>
            <p class="text-sm mb-1">Date de naissance <span class="text-red-500">*</span></p>
            <input
              type="date"
              formControlName="birthDate"
              class="px-4 py-2 border bg-card border-gray-300 rounded-lg focus:ring-1 focus:ring-primary-500 focus:border-primary-500 focus:outline-none w-full"
            />
            <div
              *ngIf="
                createStudentForm.get('birthDate')?.invalid &&
                createStudentForm.get('birthDate')?.touched
              "
              class="text-red-500 text-xs mt-1"
            >
              La date de naissance est requise
            </div>
          </div>

          <div>
            <p class="text-sm mb-1">Genre <span class="text-red-500">*</span></p>
            <select
              formControlName="gender"
              class="px-4 py-2 border bg-card border-gray-300 rounded-lg focus:ring-1 focus:ring-primary-500 focus:border-primary-500 focus:outline-none w-full cursor-pointer"
            >
              <option value="" disabled selected>Sélectionner un genre</option>
              <option *ngFor="let gender of genderOptions" [value]="gender.value">
                {{ gender.label }}
              </option>
            </select>
            <div
              *ngIf="
                createStudentForm.get('gender')?.invalid &&
                createStudentForm.get('gender')?.touched
              "
              class="text-red-500 text-xs mt-1"
            >
              Le genre est requis
            </div>
          </div>
        </div>
      </div>

      <!-- Informations parentales -->
      <div class="border-b pb-4">
        <h3 class="text-md font-semibold mb-3">Informations parentales</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <p class="text-sm mb-1">Prénom du parent <span class="text-red-500">*</span></p>
            <input
              type="text"
              formControlName="parentFirstName"
              class="px-4 py-2 border bg-card border-gray-300 rounded-lg focus:ring-1 focus:ring-primary-500 focus:border-primary-500 focus:outline-none w-full"
              placeholder="Prénom du parent"
            />
            <div
              *ngIf="
                createStudentForm.get('parentFirstName')?.invalid &&
                createStudentForm.get('parentFirstName')?.touched
              "
              class="text-red-500 text-xs mt-1"
            >
              Le prénom du parent est requis
            </div>
          </div>

          <div>
            <p class="text-sm mb-1">Nom du parent <span class="text-red-500">*</span></p>
            <input
              type="text"
              formControlName="parentLastName"
              class="px-4 py-2 border bg-card border-gray-300 rounded-lg focus:ring-1 focus:ring-primary-500 focus:border-primary-500 focus:outline-none w-full"
              placeholder="Nom du parent"
            />
            <div
              *ngIf="
                createStudentForm.get('parentLastName')?.invalid &&
                createStudentForm.get('parentLastName')?.touched
              "
              class="text-red-500 text-xs mt-1"
            >
              Le nom du parent est requis
            </div>
          </div>

          <div>
            <p class="text-sm mb-1">Téléphone du parent <span class="text-red-500">*</span></p>
            <input
              type="tel"
              formControlName="parentPhoneNumber"
              class="px-4 py-2 border bg-card border-gray-300 rounded-lg focus:ring-1 focus:ring-primary-500 focus:border-primary-500 focus:outline-none w-full"
              placeholder="+221 77 123 45 67"
            />
            <div
              *ngIf="
                createStudentForm.get('parentPhoneNumber')?.invalid &&
                createStudentForm.get('parentPhoneNumber')?.touched
              "
              class="text-red-500 text-xs mt-1"
            >
              Le téléphone du parent est requis
            </div>
          </div>

          <div>
            <p class="text-sm mb-1">Email du parent</p>
            <input
              type="email"
              formControlName="parentEmail"
              class="px-4 py-2 border bg-card border-gray-300 rounded-lg focus:ring-1 focus:ring-primary-500 focus:border-primary-500 focus:outline-none w-full"
              placeholder="parent@example.com"
            />
            <div
              *ngIf="
                createStudentForm.get('parentEmail')?.invalid &&
                createStudentForm.get('parentEmail')?.touched
              "
              class="text-red-500 text-xs mt-1"
            >
              L'email n'est pas valide
            </div>
          </div>
        </div>
      </div>

      <!-- Affectation scolaire -->
      <div>
        <h3 class="text-md font-semibold mb-3">Affectation scolaire</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <!-- Champ École (masqué pour les directeurs) -->
          <div *ngIf="!isDirector">
            <p class="text-sm mb-1">École <span class="text-red-500">*</span></p>
            <select
              formControlName="school"
              class="px-4 py-2 border bg-card border-gray-300 rounded-lg focus:ring-1 focus:ring-primary-500 focus:border-primary-500 focus:outline-none w-full cursor-pointer"
              [disabled]="isLoadingSchools"
            >
              <option value="" disabled selected>
                {{ isLoadingSchools ? 'Chargement...' : 'Sélectionner une école' }}
              </option>
              <option *ngFor="let school of schools" [value]="school._id || school.id">
                {{ school.name }}
              </option>
            </select>
            <div
              *ngIf="
                createStudentForm.get('school')?.invalid &&
                createStudentForm.get('school')?.touched
              "
              class="text-red-500 text-xs mt-1"
            >
              L'école est requise
            </div>
          </div>

          <!-- Champ Classe -->
          <div [ngClass]="{'md:col-span-2': isDirector}">
            <p class="text-sm mb-1">Classe <span class="text-red-500">*</span></p>
            <select
              formControlName="class"
              class="px-4 py-2 border bg-card border-gray-300 rounded-lg focus:ring-1 focus:ring-primary-500 focus:border-primary-500 focus:outline-none w-full cursor-pointer"
              [disabled]="isLoadingClasses || (!isDirector && !createStudentForm.value.school)"
            >
              <option value="" disabled selected>
                {{ isLoadingClasses ? 'Chargement...' : (!isDirector && !createStudentForm.value.school) ? 'Sélectionnez d\'abord une école' : (classes.length === 0 ? 'Aucune classe disponible' : 'Sélectionner une classe') }}
              </option>
              <option *ngFor="let cls of classes" [value]="cls._id || cls.id">
                {{ cls.name }}
              </option>
            </select>
            <div
              *ngIf="
                createStudentForm.get('class')?.invalid &&
                createStudentForm.get('class')?.touched
              "
              class="text-red-500 text-xs mt-1"
            >
              La classe est requise
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="mt-4 px-6 pb-6 sticky bottom-0 bg-card border-t pt-4">
      <button
        type="submit"
        [disabled]="createStudentForm.invalid"
        class="bg-primary-500 text-white rounded cursor-pointer w-full px-6 py-2 hover:bg-primary-600 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
      >
        {{ isEditing ? 'Modifier' : 'Inscrire' }} l'élève
      </button>
    </div>
  </form>
</div>

