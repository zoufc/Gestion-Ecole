<div class="flex flex-col">
  <!-- Header -->
  <div class="flex justify-between items-center mb-4">
    <div>
      <button (click)="goBack()" class="flex items-center gap-2 px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300 mb-2">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12.5 15L7.5 10L12.5 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Retour
      </button>
      <p class="text-xl font-bold">
        <span class="text-[#707070]">Accueil / Management / Classes /</span>
        <span class="text-primary-text">{{ classDetails()?.name || 'Chargement...' }}</span>
      </p>
    </div>
  </div>

  <!-- Informations de la classe -->
  <div *ngIf="isLoadingClass" class="bg-card text-primary-text shadow-lg rounded-lg p-6 mt-8">
    <ngx-skeleton-loader appearance="line" [theme]="{ 'border-radius': '8px', width: '100%', height: '100px', margin: 0 }">
    </ngx-skeleton-loader>
  </div>

  <div *ngIf="!isLoadingClass && classDetails()" class="bg-card text-primary-text shadow-lg rounded-lg p-6 mt-8">
    <div class="grid md:grid-cols-4 gap-6">
      <div class="flex items-center gap-4">
        <div class="bg-primary-100 rounded-full p-4">
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M12 2L2 7L12 12L22 7L12 2Z" stroke="#7367F0" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M2 17L12 22L22 17" stroke="#7367F0" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M2 12L12 17L22 12" stroke="#7367F0" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <div>
          <div class="text-sm text-gray-600">Classe</div>
          <div class="text-2xl font-bold">{{ classDetails()?.name }}</div>
        </div>
      </div>
      <div>
        <div class="text-sm text-gray-600">Niveau</div>
        <div class="text-xl font-semibold">{{ classDetails()?.level }}</div>
      </div>
      <div>
        <div class="text-sm text-gray-600">Enseignant principal</div>
        <div class="text-xl font-semibold">{{ classDetails()?.teacher_name || 'Non assigné' }}</div>
      </div>
      <div>
        <div class="text-sm text-gray-600">Salle</div>
        <div class="text-xl font-semibold">{{ classDetails()?.classroom || 'Non définie' }}</div>
      </div>
    </div>
  </div>

  <!-- Liste des élèves -->
  <div class="mt-8">
    <h3 class="text-xl font-bold mb-4 text-primary-text">Élèves de la classe ({{ studentsList().length }})</h3>
    <div class="bg-card text-primary-text shadow-lg rounded-lg p-6">
      <div *ngIf="isLoadingStudents" class="grid md:grid-cols-3 gap-4">
        <div *ngFor="let i of [1,2,3,4,5,6]">
          <ngx-skeleton-loader appearance="line" 
            [theme]="{ 'border-radius': '8px', width: '100%', height: '80px', margin: 0 }">
          </ngx-skeleton-loader>
        </div>
      </div>

      <div *ngIf="!isLoadingStudents && studentsList().length > 0" class="grid md:grid-cols-3 gap-4">
        <div *ngFor="let student of studentsList()" 
          (click)="goToStudentDetail(student.id)"
          class="bg-white rounded-lg p-4 border-2 border-gray-200 hover:border-primary-500 cursor-pointer transition-all hover:shadow-lg">
          <div class="flex items-center gap-4">
            <div class="bg-primary-100 rounded-full p-3">
              <svg width="32" height="32" viewBox="0 0 38 38" fill="none" xmlns="http://www.w3.org/2000/svg">
                <g clip-path="url(#clip0_50_5632)">
                  <rect x="-0.1604" y="0.0273438" width="38" height="38" fill="#FC2828" fill-opacity="0.18" />
                  <path
                    d="M13.4942 24.9195C13.1242 24.9195 12.7667 24.8795 12.4217 24.7995C12.0767 24.7195 11.8392 24.657 11.7092 24.612L11.7917 23.097C11.9467 23.147 12.1217 23.2095 12.3167 23.2845C12.5167 23.3545 12.7592 23.3895 13.0442 23.3895C13.5342 23.3895 13.8692 23.2545 14.0492 22.9845C14.2292 22.7145 14.3192 22.267 14.3192 21.642V13.9245H15.9317V22.0845C15.9317 22.6945 15.8617 23.212 15.7217 23.637C15.5867 24.057 15.3442 24.377 14.9942 24.597C14.6442 24.812 14.1442 24.9195 13.4942 24.9195ZM18.3933 24.7695V13.9245H20.0658V19.362L24.6783 13.9245H26.5683L23.0283 18.1695L26.8983 24.7695H25.1133L21.8658 19.3395L20.0658 21.432V24.7695H18.3933Z"
                    fill="#FC2828" />
                </g>
                <defs>
                  <clipPath id="clip0_50_5632">
                    <rect width="38" height="38" rx="19" fill="white" />
                  </clipPath>
                </defs>
              </svg>
            </div>
            <div class="flex-1">
              <div class="font-bold">{{ student.first_name }} {{ student.last_name }}</div>
              <div class="text-sm text-gray-600">N° {{ student.student_number }}</div>
              <div class="text-xs text-gray-500">{{ student.email }}</div>
            </div>
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="text-gray-400">
              <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
          </div>
        </div>
      </div>

      <div *ngIf="!isLoadingStudents && studentsList().length === 0" class="text-center py-12 text-gray-500">
        <p class="text-lg">Aucun élève dans cette classe</p>
      </div>
    </div>
  </div>

  <!-- Emploi du temps -->
  <div class="mt-8">
    <h3 class="text-xl font-bold mb-4 text-primary-text">Emploi du temps</h3>
    <div class="bg-card text-primary-text shadow-lg rounded-lg p-6">
      <div *ngIf="isLoadingSchedule" class="w-full">
        <ngx-skeleton-loader appearance="line" 
          [theme]="{ 'border-radius': '8px', width: '100%', height: '500px', margin: 0 }">
        </ngx-skeleton-loader>
      </div>

      <div *ngIf="!isLoadingSchedule" class="overflow-x-auto">
        <!-- Grille de l'emploi du temps améliorée -->
        <div class="min-w-full">
          <!-- En-tête avec les jours -->
          <div class="grid grid-cols-8 gap-2 mb-2 sticky top-0 bg-card z-10">
            <div class="p-3 font-bold text-center text-sm text-gray-700 bg-gray-50 rounded-lg">Heure</div>
            <div *ngFor="let day of daysOfWeek" class="p-3 font-bold text-center text-sm bg-primary-500 text-white rounded-lg">
              {{ day.name }}
            </div>
          </div>

          <!-- Lignes pour chaque créneau horaire principal -->
          <div *ngFor="let timeSlot of mainTimeSlots" class="grid grid-cols-8 gap-2 mb-2">
            <!-- Colonne heure -->
            <div class="p-3 text-sm font-semibold text-gray-700 bg-gray-50 rounded-lg text-center border-r-2 border-gray-200">
              <div>{{ formatTime(timeSlot.start) }}</div>
              <div class="text-xs text-gray-500">{{ formatTime(timeSlot.end) }}</div>
            </div>
            
            <!-- Colonnes pour chaque jour -->
            <div *ngFor="let day of daysOfWeek" 
              class="relative min-h-[100px] border-2 border-gray-200 rounded-lg bg-white hover:bg-gray-50 transition-colors">
              <ng-container *ngFor="let scheduleItem of getSchedulesForTimeSlot(day.id, timeSlot)">
                <div class="absolute inset-2 rounded-lg p-3 text-white shadow-md hover:shadow-lg transition-shadow"
                  [style.background]="getSubjectGradient(scheduleItem.subject_name)">
                  <div class="font-bold text-sm mb-1">{{ scheduleItem.subject_name }}</div>
                  <div class="text-xs opacity-95 mb-1">
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="inline-block mr-1">
                      <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/>
                      <path d="M12 6V12L16 14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    {{ formatTime(scheduleItem.start_time) }} - {{ formatTime(scheduleItem.end_time) }}
                  </div>
                  <div class="text-xs opacity-90 mb-1">
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="inline-block mr-1">
                      <path d="M20 21V19C20 17.9391 19.5786 16.9217 18.8284 16.1716C18.0783 15.4214 17.0609 15 16 15H8C6.93913 15 5.92172 15.4214 5.17157 16.1716C4.42143 16.9217 4 17.9391 4 19V21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      <circle cx="12" cy="7" r="4" stroke="currentColor" stroke-width="2"/>
                    </svg>
                    {{ scheduleItem.teacher_name }}
                  </div>
                  <div class="text-xs opacity-90">
                    <svg width="12" height="12" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="inline-block mr-1">
                      <path d="M3 9L12 2L21 9V20C21 20.5304 20.7893 21.0391 20.4142 21.4142C20.0391 21.7893 19.5304 22 19 22H5C4.46957 22 3.96086 21.7893 3.58579 21.4142C3.21071 21.0391 3 20.5304 3 20V9Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      <path d="M9 22V12H15V22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    {{ scheduleItem.classroom }}
                  </div>
                </div>
              </ng-container>
              <div *ngIf="!hasScheduleForTimeSlot(day.id, timeSlot)" 
                class="flex items-center justify-center h-full text-gray-400 text-xs">
                -
              </div>
            </div>
          </div>
        </div>
      </div>

      <div *ngIf="!isLoadingSchedule && schedule().length === 0" class="text-center py-12 text-gray-500">
        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="mx-auto mb-4 opacity-50">
          <rect x="3" y="4" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2"/>
          <path d="M16 2V6M8 2V6M3 10H21" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
        <p class="text-lg">Aucun emploi du temps défini pour cette classe</p>
      </div>
    </div>
  </div>
</div>
